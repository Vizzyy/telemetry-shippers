[INPUT]
    Name                tail
    Tag                 ecs.*
    Path                /var/lib/docker/containers/*/*-json.log
    Docker_Mode         On
    Docker_Mode_Flush   5
    Docker_Mode_Parser  container_firstline
    Parser              docker
    DB                  /flb_container.db
    Mem_Buf_Limit       50MB
    Skip_Long_Lines     On
    Refresh_Interval    10
    Rotate_Wait         30
    Read_From_Head      Off
    storage.type        filesystem


[FILTER]
    Name ecs
    Match *
    Log_Level debug
    ECS_Tag_Prefix ecs.var.lib.docker.containers.
    ADD clusterName $ClusterName
    ADD ContainerInstanceARN $ContainerInstanceARN
    ADD ContainerInstanceID $ContainerInstanceID
    ADD ECSContainerName $ECSContainerName
    ADD DockerContainerName $DockerContainerName
    ADD ContainerID    $ContainerID
    ADD TaskFamily  $TaskDefinitionFamily
    ADD TaskId $TaskID

[FILTER]
    Name        nest
    Match       *
    Operation   nest
    Wildcard    *
    Nest_under  json 

[FILTER]
    Name    lua
    Match   *
    script  /fluent-bit/bin/script.lua
    call    addcrxmetadata
    time_as_table true

[OUTPUT]
    Name                  http
    Match                 *
    Host                  ingress.coralogix.com
    Port                  443
    URI                   /logs/rest/singles
    Format                json_lines
    TLS                   On
    Header                private_key be1fe366-ed73-a842-bb3e-74fa24c1c3fe
    compress              gzip
    Retry_Limit           10

[SERVICE]
    flush                     1
    log_Level                 debug
    storage.path              /var/lib/docker/containers/
    storage.sync              normal
    storage.checksum          off
    storage.max_chunks_up     128
    storage.backlog.mem_limit 5M
